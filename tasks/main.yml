---
- name: install node and npm
  shell: /usr/local/n/bin/n 6.9.2
- name: Create a temp directory to run the script
  #become: true
  #become_user: root
  command: mktemp -d
  register: result
- name: debug
  debug: msg="{{result.stdout}}/node_modules"
- name: Create node_modules dir
  #become: true
  #become_user: root
  file: path={{result.stdout}}/node_modules state=directory
- name: Transfer the script
  #become: true
  #become_user: root
  copy: src=npm_config_client.js dest={{result.stdout}} mode=0777
- name: asdfasdf
  command: npm -version
  register: res2
- name: debug
  debug: msg="{{res2.stdout}}"
# - name: npm init
#  become: true
#  become_user: root
#  command: npm init -y chdir={{result.stdout}}
- name: Download npm libraries
  #become: true
  #become_user: root
  command: "{{item}}"
  with_items:
    - npm install cloud-config-client  -g
    - npm install minimist -g
    - npm install mkdirp -g
    - npm install handlebars -g
- name: Execute the script
  command: node {{result.stdout}}/npm_config_client.js --folder '{{dir}}' --application_name '{{application_name}}' --properties_file '{{properties_file}}' --template '{{template}}' --config_server_ip '{{config_server_ip}}'
